# Netlify Configuration for FNT Motor Group

[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

# Build environment variables
[build.environment]
  NODE_VERSION = "20"

# Redirects for SPA routing
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false
  conditions = {Role = []}

# Scheduled Function: AutoTrader Stock Sync
# AutoTrader Go-Live Requirement: Maximum 3 API polls per day
# Runs every 8 hours as fallback (webhooks handle real-time updates)
# Requires Netlify Pro plan or higher
[functions."sync-stock"]
  schedule = "0 */12 * * *"  # Every 12 hours (at 00:00, 12:00 UTC)

# Function settings
[functions]
  node_bundler = "esbuild"

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"

# Headers for Netlify Functions
[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Headers = "Content-Type, Authorization, X-Autotrader-Signature"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"

# Environment-specific settings
[context.production]
  [context.production.environment]
    AUTOTRADER_ENVIRONMENT = "production"

[context.deploy-preview]
  [context.deploy-preview.environment]
    AUTOTRADER_ENVIRONMENT = "sandbox"

[context.branch-deploy]
  [context.branch-deploy.environment]
    AUTOTRADER_ENVIRONMENT = "sandbox"
